<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rhythm Game</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background: #1a1a1a;
        color: white;
        overflow: hidden;
        height: 100vh;
        width: 100vw;
        margin: 0;
        padding: 0;
      }

      /* ëœë”© í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
      .landing-page {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(
          135deg,
          #2c3e50 0%,
          #3498db 50%,
          #9b59b6 100%
        );
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      .landing-page.hidden {
        display: none;
      }

      .landing-title {
        font-size: 4rem;
        font-weight: bold;
        text-align: center;
        margin-bottom: 2rem;
        text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        background: linear-gradient(45deg, #ff6b9d, #4ecdc4, #ffd93d);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .landing-subtitle {
        font-size: 1.2rem;
        text-align: center;
        margin-bottom: 3rem;
        opacity: 0.8;
      }

      .url-input-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .url-input {
        width: 500px;
        padding: 1rem 1.5rem;
        font-size: 1.1rem;
        border: 3px solid #4ecdc4;
        border-radius: 50px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        text-align: center;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }

      .url-input::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      .url-input:focus {
        outline: none;
        border-color: #ff6b9d;
        background: rgba(255, 255, 255, 0.2);
        box-shadow: 0 0 20px rgba(255, 107, 157, 0.3);
        transform: scale(1.02);
      }

      .start-button {
        padding: 1rem 3rem;
        font-size: 1.3rem;
        font-weight: bold;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        background: linear-gradient(45deg, #ff6b9d, #4ecdc4);
        color: white;
        transition: all 0.3s ease;
        box-shadow: 0 6px 20px rgba(255, 107, 157, 0.3);
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .start-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(255, 107, 157, 0.4);
        background: linear-gradient(45deg, #4ecdc4, #ff6b9d);
      }

      .start-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .loading-container {
        display: none;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        margin-top: 2rem;
      }

      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid #4ecdc4;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      .loading-text {
        font-size: 1.1rem;
        opacity: 0.8;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .game-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        background: linear-gradient(
          135deg,
          #ff6b9d 0%,
          #c44569 25%,
          #f8b500 50%,
          #40e0d0 75%,
          #ee5a52 100%
        );
        display: none;
      }

      .game-container.active {
        display: block;
      }

      /* ìƒë‹¨ UI - ì²´ë ¥ë°” */
      .health-container {
        position: absolute;
        top: 20px;
        left: 20px;
        background: linear-gradient(90deg, #333 0%, #666 100%);
        border: 3px solid #888;
        border-radius: 15px;
        padding: 8px;
        z-index: 200;
      }

      .health-label {
        color: #ff4444;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        margin-bottom: 5px;
      }

      .health-bar {
        width: 200px;
        height: 20px;
        background: #000;
        border-radius: 10px;
        border: 2px solid #fff;
        position: relative;
        overflow: hidden;
      }

      .health-fill {
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          #00ff00 0%,
          #ffff00 50%,
          #ff0000 100%
        );
        transition: width 0.3s ease;
        border-radius: 8px;
      }

      /* ìƒë‹¨ UI - ì ìˆ˜ */
      .score-container {
        position: absolute;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #333 0%, #555 100%);
        border: 3px solid #4ecdc4;
        border-radius: 15px;
        padding: 15px 25px;
        text-align: right;
        z-index: 200;
      }

      .score-label {
        color: #4ecdc4;
        font-size: 14px;
        font-weight: bold;
      }

      .score-value {
        color: #4ecdc4;
        font-size: 28px;
        font-weight: bold;
        text-shadow: 0 0 10px rgba(78, 205, 196, 0.8);
      }

      /* ë…¸ë˜ ì •ë³´ */
      .song-info {
        position: absolute;
        top: 120px;
        right: 20px;
        background: linear-gradient(135deg, #333 0%, #555 100%);
        border: 2px solid #ffd93d;
        border-radius: 10px;
        padding: 8px 15px;
        z-index: 200;
      }

      .song-title {
        color: #ffd93d;
        font-size: 16px;
        font-weight: bold;
      }

      /* ì½¤ë³´ */
      .combo-container {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        background: linear-gradient(135deg, #333 0%, #555 100%);
        border: 3px solid #a55eea;
        border-radius: 15px;
        padding: 15px;
        text-align: center;
        z-index: 200;
      }

      .combo-label {
        color: #a55eea;
        font-size: 14px;
        font-weight: bold;
      }

      .combo-value {
        color: #a55eea;
        font-size: 36px;
        font-weight: bold;
        text-shadow: 0 0 15px rgba(165, 94, 234, 0.8);
      }

      /* ë©”ì¸ ê²Œì„ ì˜ì—­ - í™”ë©´ ì „ì²´ë¥¼ í„°ë„ë¡œ */
      .tunnel-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        perspective: 800px;
        perspective-origin: center 20%;
        transform-style: preserve-3d;
        z-index: 1;
      }

      /* í„°ë„ ë°”ë‹¥ - í™”ë©´ ì „ì²´ë¥¼ ë®ë„ë¡ */
      .tunnel-floor {
        position: absolute;
        top: -100vh;
        left: 50%;
        transform: translateX(-50%) rotateX(45deg);
        width: 100vw;
        height: 400vh;
        background: #000;
        transform-style: preserve-3d;
        z-index: 2;
      }

      /* 4ê°œ ë ˆì¸ - ìì—°ìŠ¤ëŸ¬ìš´ ì›ê·¼ë²• */
      .lane {
        position: absolute;
        top: 0;
        height: 100%;
        transform-style: preserve-3d;
        border-left: 4px solid;
        border-right: 4px solid;
        /* ìœ„ìª½ì´ ì•½ê°„ ì¢ì•„ì§€ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ì›ê·¼ë²• */
        clip-path: polygon(15% 0%, 85% 0%, 90% 100%, 10% 100%);
      }

      .lane-0 {
        left: 0;
        width: 25%;
        background: linear-gradient(
          to bottom,
          rgba(255, 107, 181, 0.2) 0%,
          rgba(255, 107, 181, 0.4) 30%,
          rgba(255, 107, 181, 0.6) 70%,
          rgba(255, 107, 181, 0.9) 100%
        );
        border-color: #ff6bb5;
        box-shadow: inset 0 0 50px rgba(255, 107, 181, 0.3),
          0 0 20px rgba(255, 107, 181, 0.4);
      }

      .lane-1 {
        left: 25%;
        width: 25%;
        background: linear-gradient(
          to bottom,
          rgba(64, 224, 208, 0.2) 0%,
          rgba(64, 224, 208, 0.4) 30%,
          rgba(64, 224, 208, 0.6) 70%,
          rgba(64, 224, 208, 0.9) 100%
        );
        border-color: #40e0d0;
        box-shadow: inset 0 0 50px rgba(64, 224, 208, 0.3),
          0 0 20px rgba(64, 224, 208, 0.4);
      }

      .lane-2 {
        left: 50%;
        width: 25%;
        background: linear-gradient(
          to bottom,
          rgba(64, 224, 208, 0.2) 0%,
          rgba(64, 224, 208, 0.4) 30%,
          rgba(64, 224, 208, 0.6) 70%,
          rgba(64, 224, 208, 0.9) 100%
        );
        border-color: #40e0d0;
        box-shadow: inset 0 0 50px rgba(64, 224, 208, 0.3),
          0 0 20px rgba(64, 224, 208, 0.4);
      }

      .lane-3 {
        left: 75%;
        width: 25%;
        background: linear-gradient(
          to bottom,
          rgba(248, 181, 0, 0.2) 0%,
          rgba(248, 181, 0, 0.4) 30%,
          rgba(248, 181, 0, 0.6) 70%,
          rgba(248, 181, 0, 0.9) 100%
        );
        border-color: #f8b500;
        box-shadow: inset 0 0 50px rgba(248, 181, 0, 0.3),
          0 0 20px rgba(248, 181, 0, 0.4);
      }

      /* í•˜ë‹¨ íƒ€ê²Ÿ ë°” ì»¨í…Œì´ë„ˆ - 3D ë³€í˜•ì— ë§ì¶° ë°°ì¹˜ */
      .target-container {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100vw;
        height: 200px;
        z-index: 150;
        pointer-events: none;
      }

      /* ê³µí†µ íƒ€ê²Ÿ ë°” ìŠ¤íƒ€ì¼ */
      .hit-target {
        position: absolute;
        bottom: 60px;
        width: 15%;
        height: 60px;
        border-radius: 20px;
        border: 3px solid;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.4) 0%,
          rgba(255, 255, 255, 0.2) 50%,
          rgba(255, 255, 255, 0.3) 100%
        );
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.6),
          inset 0 2px 8px rgba(255, 255, 255, 0.3),
          inset 0 -2px 8px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
        transform-origin: center bottom;
      }

      /* ê° ë ˆì¸ë³„ ìœ„ì¹˜ì™€ 3D ë³€í˜• ì ìš© - ë ˆì¸ ì¤‘ì•™ì— ì •í™•íˆ ë°°ì¹˜ */
      .hit-target-0 {
        left: 15%;
        transform: perspective(600px) rotateY(8deg) rotateX(-45deg)
          translateX(-50%);
        border-color: #ff6bb5;
        background: linear-gradient(
          135deg,
          rgba(255, 107, 181, 0.6) 0%,
          rgba(255, 107, 181, 0.3) 50%,
          rgba(255, 107, 181, 0.5) 100%
        );
        box-shadow: 0 0 30px rgba(255, 107, 181, 0.8),
          inset 0 2px 8px rgba(255, 255, 255, 0.4);
      }

      .hit-target-1 {
        left: 38.5%;
        transform: perspective(600px) rotateY(3deg) rotateX(-45deg)
          translateX(-50%);
        border-color: #40e0d0;
        background: linear-gradient(
          135deg,
          rgba(64, 224, 208, 0.6) 0%,
          rgba(64, 224, 208, 0.3) 50%,
          rgba(64, 224, 208, 0.5) 100%
        );
        box-shadow: 0 0 30px rgba(64, 224, 208, 0.8),
          inset 0 2px 8px rgba(255, 255, 255, 0.4);
      }

      .hit-target-2 {
        left: 61.5%;
        transform: perspective(600px) rotateY(-3deg) rotateX(-45deg)
          translateX(-50%);
        border-color: #40e0d0;
        background: linear-gradient(
          135deg,
          rgba(64, 224, 208, 0.6) 0%,
          rgba(64, 224, 208, 0.3) 50%,
          rgba(64, 224, 208, 0.5) 100%
        );
        box-shadow: 0 0 30px rgba(64, 224, 208, 0.8),
          inset 0 2px 8px rgba(255, 255, 255, 0.4);
      }

      .hit-target-3 {
        left: 85%;
        transform: perspective(600px) rotateY(-8deg) rotateX(-45deg)
          translateX(-50%);
        border-color: #f8b500;
        background: linear-gradient(
          135deg,
          rgba(248, 181, 0, 0.6) 0%,
          rgba(248, 181, 0, 0.3) 50%,
          rgba(248, 181, 0, 0.5) 100%
        );
        box-shadow: 0 0 30px rgba(248, 181, 0, 0.8),
          inset 0 2px 8px rgba(255, 255, 255, 0.4);
      }

      /* í‚¤ ì…ë ¥ ì‹œ í™œì„±í™” íš¨ê³¼ - 3D ë³€í˜• ìœ ì§€ */
      .hit-target-0.active {
        transform: perspective(600px) rotateY(8deg) rotateX(-45deg)
          translateX(-50%) scale(1.15);
        filter: brightness(1.3) saturate(1.2);
        box-shadow: 0 0 40px #ff6bb5, 0 0 60px rgba(255, 107, 181, 0.6),
          inset 0 0 20px rgba(255, 255, 255, 0.7);
      }

      .hit-target-1.active {
        transform: perspective(600px) rotateY(3deg) rotateX(-45deg)
          translateX(-50%) scale(1.15);
        filter: brightness(1.3) saturate(1.2);
        box-shadow: 0 0 40px #40e0d0, 0 0 60px rgba(64, 224, 208, 0.6),
          inset 0 0 20px rgba(255, 255, 255, 0.7);
      }

      .hit-target-2.active {
        transform: perspective(600px) rotateY(-3deg) rotateX(-45deg)
          translateX(-50%) scale(1.15);
        filter: brightness(1.3) saturate(1.2);
        box-shadow: 0 0 40px #40e0d0, 0 0 60px rgba(64, 224, 208, 0.6),
          inset 0 0 20px rgba(255, 255, 255, 0.7);
      }

      .hit-target-3.active {
        transform: perspective(600px) rotateY(-8deg) rotateX(-45deg)
          translateX(-50%) scale(1.15);
        filter: brightness(1.3) saturate(1.2);
        box-shadow: 0 0 40px #f8b500, 0 0 60px rgba(248, 181, 0, 0.6),
          inset 0 0 20px rgba(255, 255, 255, 0.7);
      }

      /* ë…¸íŠ¸ - ì–‘ì˜†ìœ¼ë¡œ ê¸¸ì­‰í•˜ê²Œ */
      .note {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        width: 80%;
        height: 40px;
        border-radius: 20px;
        border: 2px solid rgba(255, 255, 255, 0.9);
        background: linear-gradient(
          145deg,
          rgba(255, 255, 255, 0.9),
          rgba(200, 200, 200, 0.7)
        );
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
        z-index: 40;
      }

      /* ë…¸íŠ¸ ì• ë‹ˆë©”ì´ì…˜ */
      @keyframes notefall {
        0% {
          top: -10%;
          transform: translateX(-50%) scale(0.3);
          opacity: 0.5;
        }
        100% {
          top: 100%;
          transform: translateX(-50%) scale(1);
          opacity: 1;
        }
      }

      .note {
        animation: notefall 3s linear;
      }

      /* ì»¨íŠ¸ë¡¤ ë²„íŠ¼ */
      .controls {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 15px;
        z-index: 300;
      }

      button {
        padding: 12px 25px;
        font-size: 16px;
        font-weight: bold;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        background: linear-gradient(45deg, #4caf50, #45a049);
        color: white;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
      }

      /* ìˆ¨ê¹€ ìš”ì†Œ */
      .status {
        display: none;
      }

      #gameAudio {
        display: none;
      }

      /* íŒŒì¥ íš¨ê³¼ ì• ë‹ˆë©”ì´ì…˜ - ì•½í•˜ê²Œ */
      @keyframes rippleEffect {
        0% {
          width: 15px;
          height: 15px;
          opacity: 1;
        }
        100% {
          width: 100px;
          height: 100px;
          opacity: 0;
        }
      }

      /* íŒì • í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ */
      .judgment {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 48px;
        font-weight: bold;
        text-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
        z-index: 1000;
        animation: judgmentPop 1s ease-out forwards;
        pointer-events: none;
      }

      .judgment.perfect {
        color: #ff6bb5;
        text-shadow: 0 0 20px #ff6bb5;
      }

      .judgment.great {
        color: #40e0d0;
        text-shadow: 0 0 20px #40e0d0;
      }

      .judgment.good {
        color: #ffd93d;
        text-shadow: 0 0 20px #ffd93d;
      }

      .judgment.bad {
        color: #ff4444;
        text-shadow: 0 0 20px #ff4444;
      }

      @keyframes judgmentPop {
        0% {
          transform: translate(-50%, -50%) scale(0.5);
          opacity: 0;
        }
        20% {
          transform: translate(-50%, -50%) scale(1.2);
          opacity: 1;
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
          opacity: 0;
        }
      }

      /* ê²Œì„ ì˜¤ë²„ ëª¨ë‹¬ */
      .game-over-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 2000;
      }

      .game-over-content {
        background: linear-gradient(135deg, #333 0%, #555 100%);
        border: 3px solid #ff4444;
        border-radius: 20px;
        padding: 40px;
        text-align: center;
        box-shadow: 0 0 30px rgba(255, 68, 68, 0.5);
      }

      .game-over-title {
        font-size: 48px;
        font-weight: bold;
        color: #ff4444;
        margin-bottom: 20px;
        text-shadow: 0 0 20px #ff4444;
      }

      .game-over-score {
        font-size: 24px;
        color: white;
        margin-bottom: 30px;
      }

      .game-over-button {
        padding: 15px 30px;
        font-size: 18px;
        font-weight: bold;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        background: linear-gradient(45deg, #ff4444, #cc3333);
        color: white;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(255, 68, 68, 0.3);
      }

      .game-over-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 68, 68, 0.4);
      }

      /* ì½¤ë³´ ë³´ë„ˆìŠ¤ íš¨ê³¼ */
      .combo-bonus {
        position: fixed;
        top: 40%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 24px;
        font-weight: bold;
        color: #ffd93d;
        text-shadow: 0 0 15px #ffd93d;
        z-index: 1500;
        animation: comboBonusPop 1.5s ease-out forwards;
        pointer-events: none;
      }

      .bonus-label {
        font-size: 14px;
        color: #fff;
        text-shadow: 0 0 10px #ffd93d;
        display: block;
        margin-top: 5px;
      }

      /* ì¹´ìš´íŠ¸ë‹¤ìš´ ì˜¤ë²„ë ˆì´ */
      .countdown-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 10000;
      }

      .countdown-overlay.show {
        display: flex;
      }

      .countdown-number {
        font-size: 8rem;
        font-weight: bold;
        color: #ff6b6b;
        text-shadow: 0 0 20px rgba(255, 107, 107, 0.7);
        animation: countdownPulse 1s ease-in-out;
      }

      @keyframes countdownPulse {
        0% {
          transform: scale(0.5);
          opacity: 0;
        }
        50% {
          transform: scale(1.2);
          opacity: 1;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      /* ê°œë°œììš© ë²„íŠ¼ */
      .dev-button {
        position: fixed;
        bottom: 20px;
        left: 20px;
        padding: 10px 15px;
        background: rgba(255, 0, 0, 0.9);
        color: white;
        border: 2px solid #ff4444;
        border-radius: 8px;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        z-index: 10001;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3);
      }

      .dev-button:hover {
        background: rgba(255, 50, 50, 0.9);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 0, 0, 0.4);
      }

      @keyframes comboBonusPop {
        0% {
          transform: translate(-50%, -50%) scale(0.5);
          opacity: 0;
        }
        20% {
          transform: translate(-50%, -50%) scale(1.2);
          opacity: 1;
        }
        80% {
          transform: translate(-50%, -50%) scale(1);
          opacity: 1;
        }
        100% {
          transform: translate(-50%, -50%) scale(0.8);
          opacity: 0;
        }
      }

      /* ì½¤ë³´ ë‹¨ê³„ë³„ íš¨ê³¼ */
      .combo-yellow {
        border-color: #ffd93d !important;
        box-shadow: 0 0 20px rgba(255, 217, 61, 0.8) !important;
        animation: comboGlow 0.5s ease-in-out;
      }

      .combo-orange {
        border-color: #ff9500 !important;
        box-shadow: 0 0 25px rgba(255, 149, 0, 0.9) !important;
        animation: comboGlow 0.5s ease-in-out;
      }

      .combo-red {
        border-color: #ff4757 !important;
        box-shadow: 0 0 30px rgba(255, 71, 87, 1) !important;
        animation: comboGlow 0.5s ease-in-out;
      }

      .combo-rainbow {
        border: 3px solid;
        border-image: linear-gradient(45deg, #ff6b9d, #4ecdc4, #ffd93d, #ff6b9d)
          1;
        box-shadow: 0 0 35px rgba(255, 255, 255, 1) !important;
        animation: rainbowPulse 1s ease-in-out infinite;
      }

      @keyframes comboGlow {
        0% {
          transform: translateY(-50%) scale(1);
        }
        50% {
          transform: translateY(-50%) scale(1.1);
        }
        100% {
          transform: translateY(-50%) scale(1);
        }
      }

      @keyframes rainbowPulse {
        0%,
        100% {
          transform: translateY(-50%) scale(1);
          filter: hue-rotate(0deg) brightness(1);
        }
        50% {
          transform: translateY(-50%) scale(1.15);
          filter: hue-rotate(180deg) brightness(1.3);
        }
      }
    </style>
  </head>
  <body>
    <!-- ëœë”© í˜ì´ì§€ -->
    <div class="landing-page" id="landing-page">
      <div class="landing-title">ğŸµ Rhythm Game</div>
      <div class="landing-subtitle">
        YouTube ìŒì•…ìœ¼ë¡œ ë¦¬ë“¬ê²Œì„ì„ ì¦ê²¨ë³´ì„¸ìš”!
      </div>

      <div class="url-input-container">
        <input
          type="text"
          class="url-input"
          id="youtube-url"
          placeholder="https://www.youtube.com/watch?v=example"
          autocomplete="off"
        />
        <button
          class="start-button"
          id="start-game-button"
          onclick="processYouTubeURL()"
        >
          ê²Œì„ ì‹œì‘
        </button>
      </div>

      <div class="loading-container" id="loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-text">ìŒì›ì„ ì²˜ë¦¬í•˜ëŠ” ì¤‘...</div>
      </div>
    </div>

    <!-- ê²Œì„ í™”ë©´ -->
    <div class="game-container" id="game-container">
      <!-- ìƒë‹¨ UI -->
      <div class="health-container">
        <div class="health-label">HP</div>
        <div class="health-bar">
          <div class="health-fill" id="health-fill"></div>
        </div>
      </div>

      <div class="score-container">
        <div class="score-label">SCORE</div>
        <div class="score-value" id="score">0</div>
      </div>

      <div class="song-info">
        <div class="song-title" id="song-title">ë³€ìˆ˜í™”í•´ì•¼ë¨</div>
      </div>

      <div class="combo-container">
        <div class="combo-label">COMBO</div>
        <div class="combo-value" id="combo">0</div>
      </div>

      <!-- 3D í„°ë„ ê²Œì„ ì˜ì—­ -->
      <div class="tunnel-container">
        <div class="tunnel-floor">
          <div class="lane lane-0"></div>
          <div class="lane lane-1"></div>
          <div class="lane lane-2"></div>
          <div class="lane lane-3"></div>
        </div>
      </div>

      <!-- í•˜ë‹¨ íƒ€ê²Ÿ ì˜ì—­ -->
      <div class="target-container">
        <div class="hit-target hit-target-0"></div>
        <div class="hit-target hit-target-1"></div>
        <div class="hit-target hit-target-2"></div>
        <div class="hit-target hit-target-3"></div>
      </div>

      <!-- ì¹´ìš´íŠ¸ë‹¤ìš´ í‘œì‹œ -->
      <div class="countdown-overlay" id="countdown-overlay">
        <div class="countdown-number" id="countdown-number">3</div>
      </div>



      <!-- ìˆ¨ê²¨ì§„ ìš”ì†Œë“¤ -->
      <audio id="gameAudio">
        <source src="audio/5NarVgDFNX0.mp3" type="audio/mpeg" />
      </audio>

      <div class="status">
        <div>Status: <span id="status">Ready</span></div>
        <div>Beatmap: <span id="beatmap-info">Not loaded</span></div>
      </div>
    </div>

    <!-- ê²Œì„ ì˜¤ë²„ ëª¨ë‹¬ -->
    <div class="game-over-modal" id="game-over-modal">
      <div class="game-over-content">
        <div class="game-over-title">GAME OVER</div>
        <div class="game-over-score">
          Final Score: <span id="final-score">0</span>
        </div>
        <button class="game-over-button" onclick="restartGame()">
          Restart Game
        </button>
      </div>
    </div>

    <script>
      const API_URL = "/process-youtube";
      let beatmap = null;
      let gameStarted = false;
      let notes = [];
      let score = 0;
      let combo = 0;
      let startTime = 0;
      let health = 100;
      let activeNotes = new Map(); // í™œì„±í™”ëœ ë…¸íŠ¸ë“¤ì„ ì¶”ì 

      async function loadBeatmapFromURL(url) {
        // [MOD] ë§¤ê°œë³€ìˆ˜ë¡œ URL ë°›ë„ë¡ ë³€ê²½
        document.getElementById("status").textContent = "Loading...";
        const res = await fetch(url);
        if (!res.ok) throw new Error("Failed to load beatmap");
        beatmap = await res.json();
        document.getElementById(
          "beatmap-info"
        ).textContent = `${beatmap.events.length} events`;
        document.getElementById("status").textContent = "Beatmap loaded!";
      }

      async function processYouTubeURL() {
        // [MOD] ì „ì²´ ì¬ì‘ì„±
        const url = document.getElementById("youtube-url").value.trim();
        
        // ê°œë°œììš©: 'a' ì…ë ¥ì‹œ ê¸°ì¡´ ë¹„íŠ¸ë§µ ë¡œë“œ
        if (url === "a") {
          loadDevBeatmap();
          return;
        }
        
        if (!isValidYouTubeURL(url)) {
          alert("ì˜¬ë°”ë¥¸ YouTube URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
          return;
        }

        // ë¡œë”© UI
        const loader = document.getElementById("loading-container");
        loader.style.display = "flex";
        document.getElementById("loading-text").textContent = "ìŒì› ë³€í™˜ ì¤‘...";

        try {
          /* 1) 8001 â†’ 8000 í”„ë¡ì‹œ POST */
          const res = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ url }),
          });
          if (!res.ok) throw new Error("Backend error");
          const { mp3_url, beatmap_url, title } = await res.json(); // [MOD]

          /* 2) ì˜¤ë””ì˜¤ íƒœê·¸ src ì„¤ì • */
          const audio = document.getElementById("gameAudio");
          audio.src = mp3_url; // [MOD]

          /* 3) ë¹„íŠ¸ë§µ ë¡œë“œ */
          document.getElementById("loading-text").textContent =
            "ë¹„íŠ¸ë§µ ë¡œë“œ ì¤‘...";
          await loadBeatmapFromURL(beatmap_url); // [MOD]

          /* 4) ì œëª© í‘œì‹œ + ê²Œì„ í™”ë©´ ì „í™˜ */
          document.getElementById("song-title").textContent =
            title ?? "Unknown"; // [MOD]
          switchToGameScreen();

          /* 5) 1ì´ˆ ë’¤ ê²Œì„ ì‹œì‘ */
          setTimeout(startGame, 1000);
        } catch (err) {
          console.error(err);
          alert(err.message || "ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ!");
        } finally {
          loader.style.display = "none";
        }
      }

      function startGame() {
        if (!beatmap) {
          alert("Please load a beatmap first!");
          return;
        }

        if (gameStarted) {
          alert("Game already started!");
          return;
        }

        // 3ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
        startCountdown();
      }

      function startCountdown() {
        const overlay = document.getElementById("countdown-overlay");
        const numberEl = document.getElementById("countdown-number");
        
        overlay.classList.add("show");
        let count = 3;
        numberEl.textContent = count;

        const countdownInterval = setInterval(() => {
          count--;
          if (count > 0) {
            numberEl.textContent = count;
            // ì• ë‹ˆë©”ì´ì…˜ ì¬ì‹œì‘
            numberEl.style.animation = "none";
            requestAnimationFrame(() => {
              numberEl.style.animation = "countdownPulse 1s ease-in-out";
            });
          } else {
            clearInterval(countdownInterval);
            overlay.classList.remove("show");
            // ì‹¤ì œ ê²Œì„ ì‹œì‘
            startActualGame();
          }
        }, 1000);
      }

      function startActualGame() {
        gameStarted = true;
        startTime = Date.now();
        console.log(
          `[DEBUG] ê²Œì„ ì‹œì‘ ì‹œê°„: ${new Date(
            startTime
          ).toLocaleTimeString()}.${startTime % 1000}`
        );
        score = 0;
        combo = 0;
        document.getElementById("score").textContent = "0";
        document.getElementById("combo").textContent = "0";
        document.getElementById("status").textContent = "Playing...";

        // ìŒì•… ì¬ìƒ
        const audio = document.getElementById("gameAudio");
        audio.currentTime = 0;
        audio.play().catch((e) => console.log("Audio play failed:", e));

        // ëª¨ë“  ë…¸íŠ¸ ìƒì„±
        beatmap.events.forEach((event, index) => {
          setTimeout(() => {
            createNote(event.lane, event.type, event.time);
          }, event.time * 1000);
        });

        console.log(`Game started! ${beatmap.events.length} notes scheduled.`);
      }

      function createNote(lane, type, eventTime) {
        const laneElement = document.querySelector(`.lane-${lane}`);
        const note = document.createElement("div");
        note.className = "note";
        note.dataset.lane = lane;
        note.dataset.type = type;

        // ê³ ìœ  ID ìƒì„±
        const noteId = `note_${Date.now()}_${Math.random()}`;
        note.dataset.id = noteId;

        // ë…¸íŠ¸ ìƒ‰ìƒ ì„¤ì •
        const colors = {
          0: type === "strong" ? "#ff4757" : "#ff6bb5",
          1: type === "strong" ? "#2ed573" : "#40e0d0",
          2: type === "strong" ? "#1e90ff" : "#40e0d0",
          3: type === "strong" ? "#ffa502" : "#f8b500",
        };

        note.style.background = `linear-gradient(145deg, ${colors[lane]}, rgba(255,255,255,0.3))`;
        note.style.border = `2px solid ${colors[lane]}`;
        note.style.boxShadow = `0 0 20px ${colors[lane]}80`;

        laneElement.appendChild(note);

        // activeNotesì— ì¶”ê°€ (ê²Œì„ ì‹œì‘ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ì •í™•í•œ íˆíŠ¸ íƒ€ì´ë° ê³„ì‚°)
        // ë…¸íŠ¸ ì• ë‹ˆë©”ì´ì…˜ì´ 3ì´ˆì´ê³ , íƒ€ê²Ÿë°” ë„ë‹¬ ì‹œì  ì¡°ì • (2.8ì´ˆë¡œ ëŠ¦ì¶¤)
        const hitTime = startTime + eventTime * 1000 + 2800;
        activeNotes.set(noteId, {
          element: note,
          lane: lane,
          hitTime: hitTime,
          missed: false,
        });

        console.log(
          `[DEBUG] ë…¸íŠ¸ ìƒì„±: Lane ${lane}, EventTime: ${eventTime}s, HitTime: ${new Date(
            hitTime
          ).toLocaleTimeString()}.${hitTime % 1000}`
        );

        // 3ì´ˆ í›„ ë…¸íŠ¸ ì œê±° (ë†“ì¹œ ë…¸íŠ¸ ì²˜ë¦¬)
        setTimeout(() => {
          if (note.parentNode && activeNotes.has(noteId)) {
            // ë†“ì¹œ ë…¸íŠ¸ - BAD ì²˜ë¦¬
            const noteData = activeNotes.get(noteId);
            if (!noteData.missed) {
              showJudgment("BAD");
              updateHealth(-5); // ì²´ë ¥ 5% ê°ì†Œ
              combo = 0;
              updateUI();
            }
            activeNotes.delete(noteId);
            note.parentNode.removeChild(note);
          }
        }, 3000);
      }

      function resetGame() {
        gameStarted = false;
        score = 0;
        combo = 0;
        health = 100;
        activeNotes.clear();
        document.getElementById("score").textContent = "0";
        document.getElementById("combo").textContent = "0";
        document.getElementById("status").textContent = "Ready";
        document.getElementById("health-fill").style.width = "100%";
        document.getElementById("game-over-modal").style.display = "none";

        // ìŒì•… ì¤‘ì§€
        const audio = document.getElementById("gameAudio");
        audio.pause();
        audio.currentTime = 0;

        // ëª¨ë“  ë…¸íŠ¸ ì œê±°
        document.querySelectorAll(".note").forEach((note) => {
          if (note.parentNode) {
            note.parentNode.removeChild(note);
          }
        });

        // íŒì • í…ìŠ¤íŠ¸ ì œê±°
        document.querySelectorAll(".judgment").forEach((judgment) => {
          if (judgment.parentNode) {
            judgment.parentNode.removeChild(judgment);
          }
        });
      }

      function restartGame() {
        resetGame();
        if (beatmap) {
          startGame();
        }
      }

      function updateHealth(change) {
        health = Math.max(0, Math.min(100, health + change));
        document.getElementById("health-fill").style.width = `${health}%`;

        if (health <= 0) {
          gameOver();
        }
      }

      function gameOver() {
        gameStarted = false;
        document.getElementById("final-score").textContent =
          score.toLocaleString();
        document.getElementById("game-over-modal").style.display = "flex";

        // ìŒì•… ì¤‘ì§€
        const audio = document.getElementById("gameAudio");
        audio.pause();
      }

      function showJudgment(type) {
        const judgment = document.createElement("div");
        judgment.className = `judgment ${type.toLowerCase()}`;
        judgment.textContent = type.toUpperCase();
        document.body.appendChild(judgment);

        setTimeout(() => {
          if (judgment.parentNode) {
            judgment.parentNode.removeChild(judgment);
          }
        }, 1000);
      }

      function calculateJudgment(timeDiff) {
        const absTimeDiff = Math.abs(timeDiff);

        console.log(
          `[DEBUG] íŒì • ê³„ì‚°: rawTimeDiff=${timeDiff}ms, absTimeDiff=${absTimeDiff}ms`
        );

        // ì •ìƒì ì¸ ë¦¬ë“¬ê²Œì„ íŒì • (íƒ€ê²Ÿë°” ë‘ ë°° ê¸¸ì´ ê°œë…)
        if (absTimeDiff <= 100) return "PERFECT"; // 100ms ì´ë‚´ PERFECT
        else if (absTimeDiff <= 200) return "GREAT"; // 200ms ì´ë‚´ GREAT
        else if (absTimeDiff <= 300) return "GOOD"; // 300ms ì´ë‚´ GOOD
        else return "BAD";
      }

      function getScoreForJudgment(judgment) {
        switch (judgment) {
          case "PERFECT":
            return 100;
          case "GREAT":
            return 80;
          case "GOOD":
            return 60;
          case "BAD":
            return 0;
          default:
            return 0;
        }
      }

      function getComboBonus(combo) {
        if (combo >= 100) return 100;
        else if (combo >= 50) return 60;
        else if (combo >= 30) return 40;
        else if (combo >= 10) return 20;
        else return 0;
      }

      function showComboBonus(baseScore, bonus, totalScore) {
        if (bonus > 0) {
          const bonusElement = document.createElement("div");
          bonusElement.className = "combo-bonus";
          bonusElement.innerHTML = `+${bonus} <span class="bonus-label">COMBO BONUS!</span>`;
          document.body.appendChild(bonusElement);

          setTimeout(() => {
            if (bonusElement.parentNode) {
              bonusElement.parentNode.removeChild(bonusElement);
            }
          }, 1500);
        }
      }

      function updateComboEffects() {
        const comboContainer = document.querySelector(".combo-container");
        const comboValue = document.getElementById("combo");

        // ê¸°ì¡´ íš¨ê³¼ ì œê±°
        comboContainer.className = "combo-container";

        if (combo >= 100) {
          comboContainer.classList.add("combo-rainbow");
        } else if (combo >= 50) {
          comboContainer.classList.add("combo-red");
        } else if (combo >= 30) {
          comboContainer.classList.add("combo-orange");
        } else if (combo >= 10) {
          comboContainer.classList.add("combo-yellow");
        }
      }

      function updateUI() {
        document.getElementById("score").textContent = score.toLocaleString();
        document.getElementById("combo").textContent = combo;
      }

      // ê°œë°œììš© ê¸°ì¡´ ë¹„íŠ¸ë§µ ë¡œë“œ í•¨ìˆ˜
      function loadDevBeatmap() {
        // ê¸°ì¡´ ë¹„íŠ¸ë§µ ì§ì ‘ ë¡œë“œ (ë°±ì—”ë“œ ì—†ì´)
        loadBeatmapFromURL("/beatmaps/5ba220a0-5cfb-412e-a84c-6dc3a0b41d0e.json")
          .then(() => {
            document.getElementById("song-title").textContent = "ë¹Œë ¤ì˜¨ê³ ì–‘ì´ (Dev)";
            console.log("ê°œë°œììš© ë¹„íŠ¸ë§µ ë¡œë“œ ì™„ë£Œ");
            
            // ê¸°ì¡´ ìŒì› ì„¤ì •
            const audio = document.getElementById("gameAudio");
            audio.src = "audio/5NarVgDFNX0.mp3";
            
            // ê²Œì„ í™”ë©´ìœ¼ë¡œ ì „í™˜
            switchToGameScreen();
            
            // 1ì´ˆ í›„ ê²Œì„ ì‹œì‘
            setTimeout(startGame, 1000);
          })
          .catch((error) => {
            console.error("ê°œë°œììš© ë¹„íŠ¸ë§µ ë¡œë“œ ì‹¤íŒ¨:", error);
            alert("ë¹„íŠ¸ë§µì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          });
      }

      function handleNoteHit(lane) {
        const currentTime = Date.now();
        let bestNote = null;
        let bestTimeDiff = Infinity;

        // í•´ë‹¹ ë ˆì¸ì˜ ê°€ì¥ ê°€ê¹Œìš´ ë…¸íŠ¸ ì°¾ê¸°
        let laneNotes = [];
        for (let [noteId, noteData] of activeNotes) {
          if (noteData.lane === lane && !noteData.missed) {
            const timeDiff = Math.abs(currentTime - noteData.hitTime);
            laneNotes.push({
              id: noteId,
              timeDiff,
              hitTime: noteData.hitTime,
              rawTimeDiff: currentTime - noteData.hitTime,
            });

            if (timeDiff < bestTimeDiff && timeDiff <= 400) {
              // 400ms ì´ë‚´ë§Œ ìœ íš¨ (ì ë‹¹íˆ í›„í•œ ì„¤ì •)
              bestTimeDiff = timeDiff;
              bestNote = {
                id: noteId,
                data: noteData,
                timeDiff: currentTime - noteData.hitTime,
              };
            }
          }
        }

        console.log(
          `[DEBUG] Lane ${lane} ë…¸íŠ¸ë“¤:`,
          laneNotes.map((n) => ({
            timeDiff: n.timeDiff + "ms",
            rawDiff: n.rawTimeDiff + "ms",
            hitTime:
              new Date(n.hitTime).toLocaleTimeString() +
              "." +
              (n.hitTime % 1000),
          }))
        );
        console.log(
          `[DEBUG] ì„ íƒëœ ë…¸íŠ¸:`,
          bestNote ? { timeDiff: bestNote.timeDiff + "ms" } : "None"
        );

        if (bestNote) {
          const judgment = calculateJudgment(bestNote.timeDiff);
          const baseScore = getScoreForJudgment(judgment);

          if (judgment !== "BAD") {
            combo += 1;
            const comboBonus = getComboBonus(combo);
            const totalScore = baseScore + comboBonus;
            score += totalScore;

            showComboBonus(baseScore, comboBonus, totalScore);
            updateComboEffects();
          } else {
            combo = 0;
            score += baseScore;
            updateHealth(-5); // BADì¼ ë•Œ ì²´ë ¥ ê°ì†Œ
            updateComboEffects();
          }

          showJudgment(judgment);
          updateUI();

          // ë…¸íŠ¸ ì œê±°
          console.log(
            `[DEBUG] ë…¸íŠ¸ ì œê±° ì‹œë„: ${bestNote.id}, íŒì •: ${judgment}`
          );
          bestNote.data.missed = true;
          if (bestNote.data.element.parentNode) {
            bestNote.data.element.parentNode.removeChild(bestNote.data.element);
            console.log(`[DEBUG] ë…¸íŠ¸ DOMì—ì„œ ì œê±°ë¨: ${bestNote.id}`);
          }
          activeNotes.delete(bestNote.id);
          console.log(
            `[DEBUG] activeNotesì—ì„œ ì œê±°ë¨. ë‚¨ì€ ë…¸íŠ¸: ${activeNotes.size}`
          );

          return true;
        }

        return false;
      }

      // í‚¤ë³´ë“œ ì…ë ¥ ì²˜ë¦¬
      document.addEventListener("keydown", (event) => {
        console.log(
          `[DEBUG] í‚¤ ê°ì§€: ${event.key}, gameStarted: ${gameStarted}`
        );

        let lane = -1;
        switch (event.key.toLowerCase()) {
          case "a":
            lane = 0;
            break;
          case "s":
            lane = 1;
            break;
          case "k":
            lane = 2;
            break;
          case "l":
            lane = 3;
            break;
          default:
            console.log(`[DEBUG] ë¬´ì‹œëœ í‚¤: ${event.key}`);
            return;
        }

        console.log(`[DEBUG] ë§¤í•‘ëœ ë ˆì¸: ${lane}`);

        // íƒ€ê²Ÿ ë°” í™œì„±í™” íš¨ê³¼
        const hitTarget = document.querySelector(`.hit-target-${lane}`);
        const laneElement = document.querySelector(`.lane-${lane}`);

        hitTarget.classList.add("active");

        // ë ˆì¸ ì „ì²´ì—ë„ íš¨ê³¼ ì¶”ê°€ - ì•½í•˜ê²Œ
        laneElement.style.filter = "brightness(1.2) saturate(1.1)";
        laneElement.style.transform = "scale(1.02)";

        setTimeout(() => {
          hitTarget.classList.remove("active");
          laneElement.style.filter = "";
          laneElement.style.transform = "";
        }, 200);

        // ê²Œì„ì´ ì‹œì‘ëœ ê²½ìš° ë…¸íŠ¸ íŒì • ì²˜ë¦¬
        if (gameStarted) {
          console.log(
            `[DEBUG] í‚¤ ì…ë ¥: Lane ${lane}, CurrentTime: ${new Date().toLocaleTimeString()}.${
              Date.now() % 1000
            }, ActiveNotes: ${activeNotes.size}`
          );
          const hitResult = handleNoteHit(lane);
          console.log(`[DEBUG] handleNoteHit ê²°ê³¼: ${hitResult}`);
        } else {
          console.log(
            `[DEBUG] ê²Œì„ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŒ: gameStarted = ${gameStarted}`
          );
        }
      });

      // ëœë”© í˜ì´ì§€ ê´€ë ¨ í•¨ìˆ˜ë“¤
      function isValidYouTubeURL(url) {
        const youtubeRegex =
          /^https?:\/\/(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)[\w-]+/;
        return youtubeRegex.test(url);
      }

      function switchToGameScreen() {
        document.getElementById("landing-page").classList.add("hidden");
        document.getElementById("game-container").classList.add("active");
      }

      // Enter í‚¤ë¡œë„ ì‹œì‘ ê°€ëŠ¥í•˜ê²Œ
      document.addEventListener("DOMContentLoaded", () => {
        const urlInput = document.getElementById("youtube-url");
        urlInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            processYouTubeURL();
          }
        });
      });

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒíƒœ í™•ì¸
      window.onload = function () {
        console.log("Game loaded! Backend should be at http://localhost:8001");
      };
    </script>
  </body>
</html>
